---
title: Multi-determinantal wavefunctions
description: Configurable parameters for multi-determinantal wavefunction representation analysis
---

# Multi-determinantal wavefunctions

Let $\mathcal{B} = \{ \Psi^w_{\mathrm{SD}} \}$ be a set of $N_{\mathrm{e}}$-electron [Slater determinants](slater-determinants.md) that may be non-orthogonal. Let $\Psi_{\mathrm{CI}}$ be a multi-determinantal wavefunction constructed from the Slater determinants in $\mathcal{B}$:

$$
    \Psi_{\mathrm{CI}} =
        \sum_w \Psi^w_{\mathrm{SD}} a_w,
$$

where $a_w \in \mathbb{C}$ are the linear combination coefficients.

QSym² is able to provide symmetry assignments for multi-determinantal wavefunctions constructed from

* either an *orbit basis* generated by the action of a group $\mathcal{G}$ on a set of *origin Slater determinants* $O = \{ \Psi^x_{\mathrm{SD}} \}$:

    $$
        \mathcal{B}_{\mathcal{G} \cdot O} = \mathcal{G} \cdot O,
    $$

    where $\lvert O \rvert$ is typically smaller compared to the group order $\lvert \mathcal{G} \rvert$, and the cardinality of $\mathcal{B}_{\mathcal{G} \cdot O}$ is given by $\lvert \mathcal{G} \rvert \times \lvert O \rvert$,

* or an *eager basis*  where the Slater determinants are specified explicitly:

    $$
        \mathcal{B} = \{ \Psi^w_{\mathrm{SD}} \}.
    $$

The time complexity for the symmetry analysis of multi-determinantal wavefunctions based on an eager basis is $O(\lvert \mathcal{G} \rvert \times \lvert \mathcal{B} \rvert^2)$. However, if an orbit basis is used instead, then this time complexity is drastically reduced to $O(\lvert \mathcal{G} \rvert \times \lvert O \rvert^2)$ in QSym² thanks to its utilisation of group closure.


## Requirements

### Basis overlap matrix

To compute the overlap matrix between multi-determinantal wavefunctions in the orbit $\mathcal{G} \cdot \Psi_{\mathrm{CI}}$ that is required as part of the symmetry analysis (see [Basics/Requirements/#Basis overlap matrix](basics.md/#basis-overlap-matrix)), QSym² requires the overlap matrix for the basis functions on $\mathcal{H}_{1}$ with respect to which the spin-orbitals in the Slater determinants in the basis $\mathcal{B}$ are defined.
These basis functions are typically Gaussian atomic orbitals, and most, if not all, quantum-chemistry packages compute their overlaps as part of their inner working.
It is therefore more convenient to retrieve the atomic-orbital overlap matrix $\mathbfit{S}_{\mathcal{H}_{1}}$ (also written $\mathbfit{S}_{\mathrm{AO}}$) (and its complex-symmetric version, $\bar{\mathbfit{S}}_{\mathrm{AO}}$, whenever necessary), from quantum-chemistry packages whenever possible.
The way in which $\mathbfit{S}_{\mathrm{AO}}$ can be read in by QSym² via its Python interface will be described below.

!!! warning "$\mathbfit{S}_{\mathrm{AO}}$ from Q-Chem HDF5 archives"

    If $\mathbfit{S}_{\mathrm{AO}}$ were to be retrieved from Q-Chem HDF5 archive files (by the [`h5py`](https://www.h5py.org/) Python library), then it must be noted that the ordering of the atomic-orbital basis functions used to define this matrix (lexicographic order for Cartesian functions) is inconsistent with that used to define the molecular orbital coefficients (Q-Chem order for Cartesian functions) found in the same HDf5 archive files.

### Atomic-orbital basis angular order

As bases for $\mathcal{H}_{1}$ almost invariably consist of Gaussian atomic orbitals, QSym² requires information about their angular momenta and ordering conventions as described in [Basics/Requirements/#Atomic-orbital basis angular order](basics.md/#atomic-orbital-basis-angular-order).
Whenever possible, QSym² will attempt to construct the basis angular order information from available data, but if this cannot be done, then the required information must be provided manually (see [Basics/Requirements/#Atomic-orbital basis angular order](basics.md/#atomic-orbital-basis-angular-order) for details).


## Parameters

!!! info "Feature requirements"

    - Using the Python API requires the [`python` feature](../../getting-started/prerequisites.md/#rust-features).


At the moment, QSym² offers two ways to perform symmetry analysis for multi-determinantal wavefunctions, both of which are via the Python library API. They are:

- using an orbit basis where QSym² generates one or more orbits from one or more origin Slater determinants supplied, then calls a Python function to perform non-orthogonal configuration interaction (NOCI) on the determinants in the orbit basis, and finally performs an optimised symmetry analysis for the resulting NOCI wavefunctions, and
- using an eager basis where all basis Slater determinants must be supplied alongside their linear combination coefficients to define one or more multi-determinantal wavefunctions for which QSym² performs a non-optimised symmetry analysis.

More methods might become possible in the future. The parameter specifications for the two existing methods are shown below.

=== "Python"
    === "Orbit basis"
        ```python
        from qsym2 import (
            rep_analyse_slater_determinant,
            EigenvalueComparisonMode, #(1)!
            MagneticSymmetryAnalysisKind, #(2)!
            SymmetryTransformationKind, #(3)!
            PySpinConstraint, #(4)!
            PySlaterDeterminantReal,
            PySlaterDeterminantComplex,
        )

        ca = np.array([ #(5)!
            [+1.000, +0.000],
            [+0.000, +0.707],
            [+0.000, +0.707],
            ...
        ])
        cb = np.array([
            [+0.000, +0.707],
            [+1.000, +0.000],
            [+0.000, -0.707],
            ...
        ])
        
        occa = np.array([1.0, 1.0]) #(6)!
        occb = np.array([1.0, 0.0])

        ea = np.array([-0.51, -0.38]) #(7)!
        eb = np.array([-0.50, +0.02])

        pydet = PySlaterDeterminantReal( #(8)!
            spin_constraint=PySpinConstraint.Unrestricted, #(9)!
            complex_symmetric=False, #(10)!
            coefficients=[ca, cb], #(11)!
            occupations=[occa, occb], #(12)!
            threshold=1e-7, #(13)!
            mo_energies=[ea, eb], #(14)!
            energy=-1.30, #(15)!
        )

        rep_analyse_slater_determinant( #(16)!
            # Data
            inp_sym="mol", #(17)!
            pydet=pydet, #(17)!
            pybao=pybao, #(19)!
            sao_spatial=sao_spatial, #(20)!
            sao_spatial_h=None, #(21)!
            sao_spatial_4c=None, #(22)!
            sao_spatial_4c_h=None, #(23)!
            # Thresholds
            linear_independence_threshold=1e-7, #(24)!
            integrality_threshold=1e-7, #(25)!
            eigenvalue_comparison_mode=EigenvalueComparisonMode.Modulus, #(26)!
            # Analysis options
            use_magnetic_group=None, #(27)!
            use_double_group=False, #(28)!
            use_cayley_table=True, #(29)!
            symmetry_transformation_kind=SymmetryTransformationKind.Spatial, #(30)!
            infinite_order_to_finite=None, #(31)!
            # Other options
            write_character_table=True, #(32)!
            write_overlap_eigenvalues=True, #(33)!
            analyse_mo_symmetries=True, #(34)!
            analyse_mo_mirror_parities=False, #(35)!
            analyse_density_symmetries=False, #(36)!
        )
        ```

        1. :fontawesome-solid-laptop-code: This is a Python-exposed Rust enum, [`EigenvalueComparisonMode`](https://qsym2.dev/api/qsym2/analysis/enum.EigenvalueComparisonMode.html), for indicating the mode of eigenvalue comparison. See [Basics/Thresholds/Linear independence threshold/#Comparison mode](basics.md/#comparison-mode) for further information.
        2. :fontawesome-solid-laptop-code: This is a Python-exposed Rust enum, [`MagneticSymmetryAnalysisKind`](https://qsym2.dev/api/qsym2/drivers/representation_analysis/enum.MagneticSymmetryAnalysisKind.html), for indicating the type of magnetic symmetry to be used for symmetry analysis. See [Basics/Analysis options/#Magnetic groups](basics.md/#magnetic-groups) for further information.
        3. :fontawesome-solid-laptop-code: This is a Python-exposed Rust enum, [`SymmetryTransformationKind`](https://qsym2.dev/api/qsym2/symmetry/symmetry_transformation/enum.SymmetryTransformationKind.html), for indicating the kind of symmetry transformation to be applied on the target. See [Basics/Analysis options/#Transformation kinds](basics.md/#transformation-kinds) for further information.
        4. :fontawesome-solid-laptop-code: This is a Python-exposed Rust enum, [`PySpinConstraint`](https://qsym2.dev/api/qsym2/bindings/python/integrals/enum.PySpinConstraint.html), for indicating the spin constraint applicable to the Slater determinant. In the Python API, only two spin spaces arranged in decreasing-$m_s$ order are permitted because Python enums do not support associated values.
        5. :fontawesome-solid-users: This specifies a coefficient matrix for one spin space, which is a $N_{\mathrm{bas}} \times N_{\mathrm{MO}}$ `numpy` array. The number of basis functions, $N_{\mathrm{bas}}$, depends on the underlying spin constraint: for *generalised* spin constraint, this is twice the number of spatial basis functions, whereas for *restricted* and *unrestricted* spin constraints, this is the same as the number of spatial basis functions. Each column in the array specifies a molecular orbital which can be occupied or virtual as specified by the occupation numbers.
        6. :fontawesome-solid-users: This specifies an occupation number vector for one spin space, which is a one-dimensional `numpy` array of size $N_{\mathrm{MO}}$. Each value in this array gives the occupation number for the corresponding molecular orbital. Fractional values are allowed, but only when occupation numbers are either $0$ or $1$ can the Slater determinant symmetry be well-defined (otherwise the collection of fractionally occupied molecular orbitals does not actually form a single-determinantal wavefunction).
        7. :fontawesome-solid-users: This specifies an optional orbital energy vector for one spin space, which is a one-dimensional `numpy` array of size $N_{\mathrm{MO}}$. Each value in this array gives the orbital energy for the corresponding molecular orbital.
        8. :fontawesome-solid-users: [`PySlaterDeterminantReal`](https://qsym2.dev/api/qsym2/bindings/python/representation_analysis/slater_determinant/struct.PySlaterDeterminantReal.html) constructs a *real-valued* Slater determinant object. If a *complex-valued* Slater determinant is required instead, use [`PySlaterDeterminantComplex`](https://qsym2.dev/api/qsym2/bindings/python/representation_analysis/slater_determinant/struct.PySlaterDeterminantComplex.html).
        9. :fontawesome-solid-users: This specifies the spin constraint applicable to the Slater determinant being specified. The possible options are:
            - `PySpinConstraint.Restricted`: this specifies the *restricted* spin constraint where spatial molecular orbitals are identical across both spin spaces,
            - `PySpinConstraint.Unrestricted`: this specifies the *unrestricted* spin constraint where spatial molecular orbitals can be different across the two spin spaces,
            - `PySpinConstraint.Generalised`: this specifies the *generalised* spin constraint where each spin-orbital is now expressed in a spin-spatial direct product basis.
        10. :fontawesome-solid-users: This specifies whether the Slater determinant is to be considered with respect to a Hilbert space where the otherwise sesquilinear inner product has been replaced by a bilinear form.
        11. :fontawesome-solid-users: This specifies the coefficient matrices constituting this Slater determinant. Each matrix in this list is for one spin space.
        12. :fontawesome-solid-users: This specifies the occupation numbers for the specified molecular orbitals. Each vector in this list is for one spin space.
        13. :fontawesome-solid-users: This specifies a threshold for comparing Slater determinants. This is of no consequence for symmetry analysis.
        14. :fontawesome-solid-users: This is optional.
        15. :fontawesome-solid-users: This is optional.
        16. :fontawesome-solid-users: This is the Python driver function for representation analysis of Slater determinants.
        </br></br>:fontawesome-solid-laptop-code: This is a Python-exposed Rust function, [`rep_analyse_slater_determinant`](https://qsym2.dev/api/qsym2/bindings/python/representation_analysis/slater_determinant/fn.rep_analyse_slater_determinant.html). See the API documentation of this function for more details.
        17. :fontawesome-solid-users: This specifies the path to the `.qsym2.sym` file that contains the serialised results of the symmetry-group detection (see the documentation for the `out_sym` parameter of the Python [`detect_symmetry_group`](https://qsym2.dev/api/qsym2/bindings/python/symmetry_group_detection/fn.detect_symmetry_group.html) function in [Symmetry-group detection/#Parameters](../symmetry-group-detection.md/#parameters)). This file should have been generated by the [`detect_symmetry_group`](https://qsym2.dev/api/qsym2/bindings/python/symmetry_group_detection/fn.detect_symmetry_group.html) function on the underlying molecular system prior to representation analysis.
        </br></br>This name does not need to contain the `.qsym2.sym` extension. 
        </br></br>The symmetry results in this file will be used to construct the symmetry group $\mathcal{G}$ to be used in the subsequent representation analysis.
        18. :fontawesome-solid-users: This specifies the Slater determinant to be symmetry-analysed.
        19. :fontawesome-solid-users: This specifies the basis angular order information for the underlying basis. See [Basics/Requirements/#Atomic-orbital basis angular order](basics.md/#atomic-orbital-basis-angular-order) for details of how to specify this.
        20. :fontawesome-solid-users: This specifies the two-centre atomic-orbital spatial overlap matrix as a two-dimensional `numpy` array.
        21. :fontawesome-solid-users: This specifies the optional complex-symmetric two-centre atomic-orbital spatial overlap matrix as a two-dimensional `numpy` array. This is only required if antiunitary operations are ppresent.
        </br></br>:material-cog-sync-outline: Default: `None`.
        22. :fontawesome-solid-users: This specifies the optional four-centre atomic-orbital spatial overlap tensor as a four-dimensional `numpy` array. This is only required for density symmetry analysis.
        </br></br>:material-cog-sync-outline: Default: `None`.
        23. :fontawesome-solid-users: This specifies the optional complex-symmetric four-centre atomic-orbital spatial overlap tensor as a four-dimensional `numpy` array. This is only required for density symmetry analysis in the presence of antiunitary operations.
        </br></br>:material-cog-sync-outline: Default: `None`.
        24. :fontawesome-solid-users: This specifies a floating-point value for the linear independence threshold $\lambda^{\mathrm{thresh}}_{\mathbfit{S}}$.
        For more information, see [Basics/#Thresholds](basics.md/#thresholds).
        25. :fontawesome-solid-users: This specifies a floating-point value for the integrality threshold $\lambda^{\mathrm{thresh}}_{\mathrm{int}}$.
        For more information, see [Basics/#Thresholds](basics.md/#thresholds).
        26. :fontawesome-solid-users: This specifies the threshold comparison mode for the eigenvalues of the orbit overlap matrix $\mathbfit{S}$. The possible options are:
            - `EigenvalueComparisonMode.Real`: this specifies the *real* comparison mode where the real parts of the eigenvalues are compared against the threshold,
            - `EigenvalueComparisonMode.Modulus`: this specifies the *modulus* comparison mode where the absolute values of the eigenvalues are compared against the threshold.
        </li>For more information, see [Basics/#Thresholds](basics.md/#thresholds).
        27. :fontawesome-solid-users: This specifies whether magnetic groups, if present, shall be used for symmetry analysis. The possible options are:
            - `None`: this specifies choice 1 of [Basics/Analysis options/#Magnetic groups](basics.md/#magnetic-groups) &mdash; use the irreducible representations of the unitary group $\mathcal{G}$,
            - `MagneticSymmetryAnalysisKind.Representation`: this specifies choice 2 of [Basics/Analysis options/#Magnetic groups](basics.md/#magnetic-groups) &mdash; use the irreducible representations of the magnetic group $\mathcal{M}$, if $\mathcal{M}$ is available,
            - `MagneticSymmetryAnalysisKind.Corepresentation`: this specifies choice 3 of [Basics/Analysis options/#Magnetic groups](basics.md/#magnetic-groups) &mdash; use the irreducible corepresentations of the magnetic group $\mathcal{M}$, if $\mathcal{M}$ is available.
        </li>For more information, see [Basics/Analysis options/#Magnetic groups](basics.md/#magnetic-groups).
        28. :fontawesome-solid-users: This is a boolean specifying if double groups shall be used for symmetry analysis. The possible options are:
            - `False`: use only conventional irreducible representations or corepresentations of $\mathcal{G}$,
            - `True`: use projective irreducible representations or corepresentations of $\mathcal{G}$ obtainable via its double cover $\mathcal{G}^*$.
        </li>For more information, see [Basics/Analysis options/#Double groups](basics.md/#double-groups).
        29. :fontawesome-solid-users: This is a boolean specifying if the Cayley table for the group, if available, should be used to speed up the computation of orbit overlap matrices.
        </br></br>:material-cog-sync-outline: Default: `True`.
        30. :fontawesome-solid-users: This specifies the kind of symmetry transformations to be applied to generate the orbit for symmetry analysis.
        The possible options are:
            - `SymmetryTransformationKind.Spatial`: spatial transformation only,
            - `SymmetryTransformationKind.SpatialWithSpinTimeReversal`: spatial transformation with spin-including time reversal,
            - `SymmetryTransformationKind.Spin`: spin transformation only,
            - `SymmetryTransformationKind.SpinSpatial`: coupled spin and spatial transformations.
        </li>For more information, see [Basics/Analysis options/#Transformation kinds](basics.md/#transformation-kinds).
        31. :fontawesome-solid-users: This specifies the finite order $n$ to which all infinite-order symmetry elements, if any, are restricted. The possible options are:
            - `None`: do not restrict infinite-order symmetry elements to finite order,
            - a positive integer value: restrict all infinite-order symmetry elements to this finite order (this will be ignored if the system has no infinite-order symmetry elements).
        </li>For more information, see [Basics/Analysis options/#Infinite-order symmetry elements](basics.md/#infinite-order-symmetry-elements).
        </br></br>:material-cog-sync-outline: Default: `None`.
        32. :fontawesome-solid-users: This boolean indicates if the *symbolic* character table of the prevailing symmetry group is to be printed in the output.
        </br></br>:material-cog-sync-outline: Default: `True`.
        33. :fontawesome-solid-users: This boolean indicates if the eigenspectrum of the overlap matrix for the Slater determinant orbit should be printed out.
        </br></br>:material-cog-sync-outline: Default: `True`.
        34. :fontawesome-solid-users: This boolean indicates if the constituting molecular orbitals (MOs) are also symmetry-analysed.
        </br></br>:material-cog-sync-outline: Default: `True`.
        35. :fontawesome-solid-users: This boolean indicates if MO mirror parities (*i.e.* parities w.r.t. any mirror planes present in the system) are to be analysed alongside MO symmetries.
        </br></br>:material-cog-sync-outline: Default: `False`.
        36. :fontawesome-solid-users: This boolean indicates if density symmetries are to be analysed alongside wavefunction symmetries. If `analyse_mo_symmetries` is set to `True`, then MO density symmetries are also analysed.
        </br></br>:material-cog-sync-outline: Default: `False`.
