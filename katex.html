<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.css"
  integrity="sha384-o3WH+1yEhq+grOgz1BVYTZPyTlMXrDxnjN1By9/ba94JqJhva6wFm2Hb+URQX53v"
  crossorigin="anonymous"
/>

<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.js"
  integrity="sha384-C5yZTsgLOfuizO9kb+hrB8uSBwwvZ4yenKWU0KmWl+7bkL6Tph/KbcOa3S4zdoRE"
  crossorigin="anonymous"
></script>

<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js"
  integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh"
  crossorigin="anonymous"
  onload="renderMathInElement(document.body);"
></script>
<script>
  "use strict";
  document.addEventListener("DOMContentLoaded", function () {
    var maths = document.getElementsByClassName("language-math");
    for (var i = 0; i < maths.length; i++) {
      var el = maths[i];
      katex.render(el.innerText, el, { displayMode: true });
    }

    var codes = document.getElementsByTagName("code");
    for (i = 0; i < codes.length; i++) {
      el = codes[i];
      if (el.classList.contains("language-math")) continue;
      if (el.classList.contains("language-inline-math")) {
        katex.render(el.innerText, el);
        continue;
      }

      var parent = el.parentNode;
      if (parent.nodeName.toLowerCase() === "pre") continue;
      // TODO: Can this be done with DOM manipulation rather than string manipulation?
      // https://stackoverflow.com/q/48438067/3019990
      var inlineMath = "$" + el.outerHTML + "$";
      if (parent.innerHTML.indexOf(inlineMath) !== -1) {
        el.classList.add("language-inline-math");
        parent.innerHTML = parent.innerHTML.replace(
          "$" + el.outerHTML + "$",
          el.outerHTML,
        );
        i--;
      }
    }
  });
</script>
